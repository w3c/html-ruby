<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>HTML Ruby Markup Extensions</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 7b3ff057a, updated Sun Nov 9 18:39:50 2025 -0800" name="generator">
  <link href="https://www.w3.org/TR/html-ruby-extensions/" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="89e17a969eeaea9c97aeb686264f42c893c04232" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
</a>
</p>
   <h1 class="no-ref p-name" id="title">HTML Ruby Markup Extensions</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>,
    <time class="dt-updated" datetime="2025-11-18">18 November 2025</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/html-ruby/">https://w3c.github.io/html-ruby/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/html-ruby-extensions/">https://www.w3.org/TR/html-ruby-extensions/</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/html-ruby/issues/">GitHub</a>
      <dt class="editor">Editor:
      <dd class="editor h-card p-author vcard" data-editor-id="43241"><a class="fn p-name u-url url" href="https://florian.rivoal.net">Florian Rivoal</a> (<span class="org p-org">Invited Expert</span>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2025 <a href="https://www.w3.org/">World Wide Web Consortium</a> and WHATWG (Apple, Google, Mozilla, Microsoft). <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, and <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> rules apply. This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Ruby, a form of interlinear annotation,
are short runs of text alongside the base text.
They are typically used in East Asian documents
to indicate pronunciation or to provide a short annotation.</p>
   <p>This specification revises and extends the markup model established by HTML to express ruby.</p>
  </div>
  <h2 class="heading no-num no-ref no-toc settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>This document is governed by the
	<a href="https://www.w3.org/policies/process/20250818/" id="w3c_process_revision">18 August 2025 W3C Process Document</a>.

</p>
   <p>This document is developed
under the terms of the <a href="https://www.w3.org/2022/02/ruby-agreement">Agreement on HTML Ruby Markup</a>
between W3C and the WHATWG.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">
Introduction</span></a>
     <ol class="toc">
      <li><a href="#relations"><span class="secno">1.1</span> <span class="content">
Background and Relation to the <span data-biblio-display="inline"><cite>HTML Standard</cite></span></span></a>
     </ol>
    <li>
     <a href="#elements"><span class="secno">2</span> <span class="content">
HTML Elements for Ruby</span></a>
     <ol class="toc">
      <li>
       <a href="#the-ruby-element"><span class="secno">2.1</span> <span class="content">
The <span><code>ruby</code></span> element</span></a>
       <ol class="toc">
        <li><a href="#ruby-pairing"><span class="secno">2.1.1</span> <span class="content">
Ruby Segmentation and Pairing</span></a>
        <li><a href="#ruby-compound"><span class="secno">2.1.2</span> <span class="content">
Markup Patterns for Multi-Character Ruby</span></a>
       </ol>
      <li><a href="#the-rb-element"><span class="secno">2.2</span> <span class="content">
The <span><code>rb</code></span> element</span></a>
      <li><a href="#the-rt-element"><span class="secno">2.3</span> <span class="content">
The <span><code>rt</code></span> element</span></a>
      <li><a href="#the-rtc-element"><span class="secno">2.4</span> <span class="content">
The <span><code>rtc</code></span> element</span></a>
      <li><a href="#the-rp-element"><span class="secno">2.5</span> <span class="content">
The <span><code>rp</code></span> element</span></a>
     </ol>
    <li><a href="#optional-tags"><span class="secno">3</span> <span class="content">
Optional Tags</span></a>
    <li><a href="#rendering"><span class="secno">4</span> <span class="content">
Rendering</span></a>
    <li><a href="#conforming-features"><span class="secno">5</span> <span class="content">
Conforming Features </span></a>
    <li><a href="#html-tweaks"><span class="secno"></span> <span class="content">
Appendix A:
Editorial Tweaks to HTML</span></a>
    <li><a href="#diff-html"><span class="secno"></span> <span class="content">
Appendix B:
Comparison With The HTML Standard</span></a>
    <li><a href="#sec"><span class="secno"></span> <span class="content">
Appendix C:
Security Considerations</span></a>
    <li><a href="#priv"><span class="secno"></span> <span class="content">
Appendix D:
Privacy Considerations</span></a>
    <li><a href="#ack"><span class="secno"></span> <span class="content">
Appendix E:
Acknowledgements</span></a>
    <li>
     <a href="#changes"><span class="secno"></span> <span class="content">
Appendix F:
Changes</span></a>
     <ol class="toc">
      <li><a href="#changes-since-2024-05-wd"><span class="secno"></span> <span class="content">
Changes since the 07 May 2024 Working Draft</span></a>
      <li><a href="#changes-since-2014"><span class="secno"></span> <span class="content">
Changes since the 04 February 2014 <cite>W3C HTML Ruby Markup Extensions</cite> Working Group Note
</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">
Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ruby">Ruby</dfn> is a name for small annotations that are rendered alongside base text.
	This is especially useful for Japanese and other East Asian content
	(ruby may be called <i>furigana</i> in Japanese).
	It is most often used to provide a reading (pronunciation guide).</p>
   <p>Ruby text is usually presented alongside the base text,
	using a smaller typeface.
	The name ruby originated from a named font size
	(about half the size of the normal 10 point font)
	used by British typesetters.</p>
   <p>Typically ruby is used in East Asian scripts
	to provide phonetic transcriptions of obscure and little known characters,
	characters that the reader is not expected
	to be familiar with
	(such as children or foreigners learning to write),
	or characters that have multiple readings
	which can’t be determined by the context
	(eg. some Japanese names).
	For example it is widely used in educational materials and children’s texts,
	but it can also be readily found in many types of literature and signage.
	It is also occasionally used to convey information about the meaning of ideographic characters.</p>
   <figure>
		<img alt="An example of annotating text with ruby:
				the Japanese word for bullet-train is written with 3 kanji characters,
				written horizontally, left to right.
				Their pronunciation is indicated by 6 hiragana characters
				placed immediately above.
				The annotation is half the font size of the base it annotates." height="70" src="images/ruby-shinkansen.png" width="320">
	</figure>
   <p>Specialized markup, as defined in this document, is necessary
	to describe the semantic associations between the base text and its annotations,
	to enable its various visual layouts
	as well as correct non-visual presentation and processing.</p>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-biblio-display="inline" data-link-type="biblio" href="https://drafts.csswg.org/css-ruby-1/"><cite>CSS Ruby Annotation Layout Module Level 1</cite></a> defines the ruby layout model in CSS,
	enabling the ruby presentation described above
	and frequently desired variations.</p>
   <h3 class="heading settled" data-level="1.1" id="relations"><span class="secno">1.1. </span><span class="content">
Background and Relation to the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a></span><a class="self-link" href="#relations"></a></h3>
   <p>A set of HTML elements to markup ruby has evolved over the years in multiple specifications,
	starting from the 2001 <a data-biblio-display="inline" data-link-type="biblio" href="https://www.w3.org/TR/ruby/"><cite>Ruby Annotation</cite></a> specification
	all the way to the current <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>,
	with different incarnations varying in flexibility, complexity, or verbosity.</p>
   <p>While concise and effective in simple cases,
	the ruby model described in the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>
	(at the time of writing this document)
	is insufficiently expressive to handle all use cases well.
	Moreover, some aspects of it are also not interoperably implemented;
	yet implementing them would not completely address the remaining use cases.
	Additionally, these aspects are at odds with the CSS layout model.</p>
   <p>This specification is written to promote—​and guide implementations of—​a revised and extended model for ruby,
	in order to more completely address the needs of ruby on the Web platform.
	This effort is undertaken with the <a href="https://www.w3.org/2022/02/ruby-agreement">agreement of W3C and the WHATWG</a>.</p>
   <p><a href="#diff-html">Appendix B:
Comparison With The HTML Standard</a> summarizes the main differences,
	and provides a brief overview of why these differences are desirable.</p>
   <p>Note that the semantics of the subset of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>
	that is interoperably implemented
	remain unchanged in this extension specification,
	making the ruby model described here
	backwards compatible
	with any ruby content
	supported by existing user agents.</p>
   <div class="advisement">
		In this document,
		advisement blocks like this one
		indicate how normative parts of the document
		relate to and replace various part of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
	</div>
   <p>It is hoped that the changes described here will in time
	be adopted by the WHATWG
	and integrated into the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>,
	reducing the delta between the two documents.</p>
   <h2 class="heading settled" data-level="2" id="elements"><span class="secno">2. </span><span class="content">
HTML Elements for Ruby</span><a class="self-link" href="#elements"></a></h2>
   <div class="advisement">
		This section and it subsections replace and extendent
		sections <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-ruby-element"><cite>HTML</cite> § 4.5.10 The ruby element</a> through <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-rp-element"><cite>HTML</cite> § 4.5.12 The rp element</a>
		of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
	</div>
   <h3 class="heading settled" data-level="2.1" id="the-ruby-element"><span class="secno">2.1. </span><span class="content">
The <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-ruby"><code>ruby</code></dfn> element</span><a class="self-link" href="#the-ruby-element"></a></h3>
   <dl class="def">
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories" id="ref-for-concept-element-categories">Categories</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#flow-content-2" id="ref-for-flow-content-2">Flow content</a>.
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2">Phrasing content</a>.
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#palpable-content-2" id="ref-for-palpable-content-2">Palpable content</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts" id="ref-for-concept-element-contexts">Contexts in which this element can be used</a>:
		
    <dd>Where <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2①">phrasing content</a> is expected.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model" id="ref-for-concept-element-content-model">Content model</a>:
		
    <dd>See prose.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes">Content attributes</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes">Global attributes</a>

		
    <dt> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations" id="ref-for-concept-element-accessibility-considerations">Accessibility considerations</a>:
		
    <dd><a href="https://w3c.github.io/html-aria/#el-ruby">For authors</a>.
		
    <dd><a href="https://w3c.github.io/html-aam/#el-ruby">For implementers</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom" id="ref-for-concept-element-dom">DOM interface</a>:
		
    <dd>Uses <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement">HTMLElement</a></code>.
	
   </dl>
   <p>The <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby">ruby</a></code> element <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents">represents</a> one or more ranges of phrasing content
	paired with associated ruby annotations.
	Ruby annotations are short runs of annotation text presented alongside base text.
	Although primarily used in East Asian typography as a guide for pronunciation,
	they can also be used for other associated information.
	Ruby is most commonly presented as interlinear annotations,
	although other presentations are also used.
	<span class="non-normative">A more complete introduction to ruby and its rendering
	can be found in W3C’s <a data-biblio-display="inline" data-link-type="biblio" href="https://www.w3.org/International/questions/qa-ruby"><cite>What is ruby?</cite></a> article
	and in <a data-biblio-display="inline" data-link-type="biblio" href="https://drafts.csswg.org/css-ruby-1/"><cite>CSS Ruby Annotation Layout Module Level 1</cite></a>.</span></p>
   <div class="example" id="basic-ruby-ex">
    <a class="self-link" href="#basic-ruby-ex"></a>
		This example shows Japanese text,
		with ruby markup used to annotate the ideographs with their pronunciation.

		
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->霧<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->きり<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>ruby</c-><c- p>></c->とも<c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->霞<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->かすみ<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>ruby</c-><c- p>></c->とも
</code></pre>
    <p>A typical rendering would be something akin to the following image:</p>
    <figure>
			<img alt="A short piece of horizontal Japanese text,
					with the reading of each kanji character
					indicated by small hiragana characters above it.
					Each group of hiragana is horizontally centered
					relative to the kanji it annotates." height="75" src="images/composition.png" width="280">
		</figure>
    <p class="note" role="note"><span class="marker">Note:</span> See <a href="#ruby-optional-tag-ex">the following example</a>
		for discussion of syntax variants and simplifications.</p>
   </div>
   <p>The content model of <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①">ruby</a></code> elements consists of
	one or more of the following <a data-link-type="dfn" href="#ruby-segment" id="ref-for-ruby-segment">ruby segment</a> sequences:</p>
   <ol>
    <li>
			One or more <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2②">phrasing content</a> nodes
			or <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb">rb</a></code> elements
			(or a combination)
			<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents①">representing</a> the base-level content being annotated
			(the <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="base range" data-noexport id="ruby-base-range">ruby base range</dfn>).

		
    <li>
			One or more <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt">rt</a></code> or <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc">rtc</a></code> elements
			(or a combination)
			<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents②">representing</a> any annotations associated
			with the preceding base content,
			where each <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①">rtc</a></code> element or sequence of <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①">rt</a></code> elements
			<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents③">represents</a> one independent level of annotation
			(a <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="annotation range" data-noexport id="ruby-annotation-range">ruby annotation range</dfn>).
			Each <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range">annotation range</a>,
			and <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units">annotation units</a> within each range,
			and can optionally be preceded by / followed by / interleaved with
			individual <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp">rp</a></code> elements.
			(The optional <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①">rp</a></code> element can be used
			to add presentational content such as parentheses,
			which can be useful when rendering annotations inline,
			including as a fallback when ruby layout is not supported.)
	
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> For authoring convenience,
	the internal ruby elements <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①">rb</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②">rtc</a></code>, and <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp②">rp</a></code>
	have <a class="allow-2119" href="#optional-tags">optional end tags</a>.</p>
   <div class="example" id="ruby-optional-tag-ex">
    <a class="self-link" href="#ruby-optional-tag-ex"></a>
		In Taiwan,
		phonetic annotations for Chinese text are typically provided
		using Zhuyin characters (also known as Bopomofo).
		In mainland China,
		phonetic annotations are typically provided
		using Latin characters using Pinyin transcription.
		In this example, both are provided:

		
    <figure>
			<img alt="“Beautiful” in Chinese,
					with both pinyin and bopomofo annotations." height="84" src="images/zhuyin-mei.png" width="80">
		</figure>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-> <c- e>lang</c-><c- o>=</c-><c- s>zh-TW</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->美<c- p>&lt;/</c-><c- f>rb</c-><c- p>>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->ㄇㄟˇ<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rtc</c-> <c- e>lang</c-><c- o>=</c-><c- s>zh-Latn</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->měi<c- p>&lt;/</c-><c- f>rt</c-><c- p>>&lt;/</c-><c- f>rtc</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>Certain features of HTML ruby allow for simpler markup:

		</p>
    <ul>
     <li>End tags can be omitted.

			
     <li>
				Text contained directly by a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②">ruby</a></code> element
				implicitly represents a <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units">ruby base unit</a>
				(as if it were contained in an <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②">rb</a></code> element).

			
     <li>
				Consecutive <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt③">rt</a></code> children of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby③">ruby</a></code> element
				are implicitly grouped into a <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range①">ruby annotation range</a>
				(as if they were contained in an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③">rtc</a></code> element).

			
     <li>
				Text contained directly by an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc④">rtc</a></code> element
				implicity represents a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units①">ruby annotation unit</a>.
		
    </ul>
    <p>In effect,
		the above example is equivalent
		(in meaning, though not in the DOM it produces)
		to the following:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-> <c- e>lang</c-><c- o>=</c-><c- s>zh-TW</c-><c- p>></c->美<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ㄇㄟˇ<c- p>&lt;</c-><c- f>rtc</c-> <c- e>lang</c-><c- o>=</c-><c- s>zh-Latn</c-><c- p>></c->měi<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-biblio-display="inline" data-link-type="biblio" href="https://drafts.csswg.org/css-ruby-1/"><cite>CSS Ruby Annotation Layout Module Level 1</cite></a> enables authors
	to control the rendering of the HTML <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby④">ruby</a></code> element and its contents,
	supporting a variety of layouts based on the same markup.</p>
   <div class="example" id="ruby-bopomofo-ex">
    <a class="self-link" href="#ruby-bopomofo-ex"></a>
		Three rendering styles are commonly used with Zhuyin (Bopomofo) characters.
		(Annotations here are shown in blue for clarity,
		though in actual uses there would be no color distinction.)


    <p>When the text is written vertically,
		the phonetic annotations are rendered to the right,
		along the base text:</p>
    <figure>
			<img alt="A Chinese word composed of two characters, written vertically.
					To the right of each character,
					phonetic annotations appear,
					written vertically." height="132" src="images/zhuyin-vert.png" width="87">
		</figure>
    <p>In horizontal writing,
		they are usually also typeset to the right,
		in this case sandwiched between individual base characters:</p>
    <figure>
			<img alt="A Chinese word composed of two characters,
					written horizontally.
					To the right of each character,
					phonetic annotations appear,
					written vertically." height="66" src="images/zhuyin.png" width="174">
		</figure>
    <p>However, sometimes Zhuyin annotations are instead typeset
		above horizontal base text:</p>
    <figure>
			<img alt="A Chinese word composed of two characters,
					written horizontally.
					Above each character,
					phonetic annotations appear,
					written horizontally." height="92" src="images/zhuyin-above.png" width="125">
		</figure>
    <p>These differences are stylistic,
		not semantic,
		and therefore share the same markup:</p>
<pre lang="zh-TW"><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-> <c- e>lang</c-><c- o>=</c-><c- s>zh-TW</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->電<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->腦<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ㄉㄧㄢˋ<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ㄋㄠˇ<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
   </div>
   <h4 class="heading settled" data-level="2.1.1" id="ruby-pairing"><span class="secno">2.1.1. </span><span class="content">
Ruby Segmentation and Pairing</span><a class="self-link" href="#ruby-pairing"></a></h4>
   <p>Within a ruby element,
	content is parcelled into a series of ruby segments.
	Ignoring <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#inter-element-whitespace" id="ref-for-inter-element-whitespace">inter-element whitespace</a> and <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp③">rp</a></code> elements,
	each <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="ruby-segment">ruby segment</dfn> consists of:</p>
   <ul>
    <li>
			One <a data-link-type="dfn" href="#ruby-base-range" id="ref-for-ruby-base-range">ruby base range</a>:
			zero or more <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="base unit" data-noexport id="ruby-base-units">ruby base units</dfn>,
			each of which is either a DOM range containing a single child <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb③">rb</a></code> element
			or a maximal DOM range of child content
			that does not contain a child <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb④">rb</a></code> element.

		
    <li>
			Zero or more <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range②">ruby annotation ranges</a>,
			each a DOM range corresponding to either
			a single <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc⑤">rtc</a></code> element
			or to a maximal sequence of consecutive <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt④">rt</a></code> elements.
			The <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range③">ruby annotation range</a> is further parcelled
			into a sequence of <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="annotation unit" data-noexport id="ruby-annotation-units">ruby annotation units</dfn>:
			if it consists of a sequence of <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt⑤">rt</a></code> elements,
			then each such element is an individual <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units②">ruby annotation unit</a>;
			if it consists of an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc⑥">rtc</a></code> element,
			then each of its child <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt⑥">rt</a></code> elements
			and each maximal DOM range of non-<code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt⑦">rt</a></code> child content
			is a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units③">ruby annotation unit</a>.
	
   </ul>
   <div class="example" id="ruby-combine-ex">
    <a class="self-link" href="#ruby-combine-ex"></a>
		Annotating text character by character is also typical in Chinese.
		In this example,
		each character is individually annotated in its own <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby⑤">ruby</a></code> element:


    <p><code class="highlight" lang="zh">
			<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->千<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->qiān<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->里<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->lǐ<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->之<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->zhī<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->行<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->xíng<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->﹐<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->始<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->shǐ<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->於<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->yú<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->足<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->zú<c- p>&lt;/</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>ruby</c-><c- p>></c->下<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->xià<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->。
		</code></p>
    <figure>
			<img alt="A Chinese phrase,
				with each character phonetically annotated with a pinyin syllable" height="75" src="images/ruby-pinyin.png" width="365">
		</figure>
    <p>Multiple adjacent ruby segments can also be combined into the same <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby⑥">ruby</a></code> parent:</p>
    <p><code class="highlight" lang="zh">
			<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->千<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->qiān<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->里<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->lǐ<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->之<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->zhī<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->行<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->xíng<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->﹐<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->始<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->shǐ<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->於<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->yú<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->足<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->zú<c- p>&lt;/</c-><c- f>rt</c-><c- p>></c->下<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->xià<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->。
		</code></p>
   </div>
   <p>The process of <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="annotation-pairing">annotation pairing</dfn> associates <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units④">ruby annotation units</a>
	with <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units①">ruby base units</a>.
	Within each <a data-link-type="dfn" href="#ruby-segment" id="ref-for-ruby-segment①">ruby segment</a>,
	each <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units②">ruby base unit</a> is paired with a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units⑤">ruby annotation unit</a>
	from each <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range④">ruby annotation range</a>.
	If a <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range⑤">ruby annotation range</a> consists of an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc⑦">rtc</a></code> element
	that contains no <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt⑧">rt</a></code> elements,
	the single <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units⑥">ruby annotation unit</a> represented by its contents spans
	(is paired with)
	every <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units③">ruby base unit</a> in the <a data-link-type="dfn" href="#ruby-segment" id="ref-for-ruby-segment②">ruby segment</a>.
	Otherwise,
	each <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units⑦">ruby annotation unit</a> in the <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range⑥">ruby annotation range</a> is paired,
	in order,
	with the corresponding <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units④">ruby base unit</a> in the segment’s <a data-link-type="dfn" href="#ruby-base-range" id="ref-for-ruby-base-range①">ruby base range</a>.
	<span class="w-nodev">
		If there are not enough <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units⑤">ruby base units</a>,
		any remaining <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units⑧">ruby annotation units</a>
		are assumed to be associated
		with empty, hypothetical bases
		inserted at the end of the <a data-link-type="dfn" href="#ruby-base-range" id="ref-for-ruby-base-range②">ruby base range</a>.
		If there are not enough <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units⑨">ruby annotation units</a>
		in a <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range⑦">ruby annotation range</a>,
		the remaining <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units⑥">ruby base units</a>
		are assumed to not have an annotation from that annotation level.
	</span></p>
   <div class="example" id="ruby-inlining">
    <a class="self-link" href="#ruby-inlining"></a>
		In some contexts,
		for example when the font size or line height are too small
		for interlinear ruby to be readable,
		it is desirable to inline the ruby annotation
		such that it appears in parentheses after the text it annotates.
		This also provides an appropriate fallback rendering
		for user agents that do not support ruby layout.


    <p>However,
		for compound words in Japanese particularly,
		per-character inlined phonetics are awkward.
		Instead,
		the more natural rendering
		is to place the annotation of an entire word
		together after its base text.
		For example,
		when typeset inline,
		<span lang="ja">京都市</span> (“Kyoto City”)
		is expected to be rendered as
		“<span lang="ja">京都市（きょうとし）</span>”,
		not “<span lang="ja">京（きょう）都（と）市（し）</span>”.
		This can be marked up using consecutive <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb⑤">rb</a></code> elements followed by consecutive <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt⑨">rt</a></code> elements:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->京<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->都<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->市<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きょう<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->と<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->し<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>If each base character was immediately followed by its annotation in the markup
		(each base-annotation pair forming its own segment),
		inlining would result in the undesirable and awkward
		“<span lang="ja">京（きょう）都（と）市（し）</span>”.</p>
    <p>Note that the markup above does not automatically provide the parentheses.
		Parentheses can be inserted using CSS generated content
		when intentionally typesetting inline,
		however they would be missing
		when a UA that does not support ruby
		falls back to inline layout automatically from interlinear layout.
		The <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp④">rp</a></code> element can be inserted
		to provide the appropriate punctuation for when ruby is not supported:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->京<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->都<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->市<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->（<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きょう<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->と<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->し<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->）<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
   </div>
   <h4 class="heading non-normative settled" data-level="2.1.2" id="ruby-compound"><span class="secno">2.1.2. </span><span class="content">
Markup Patterns for Multi-Character Ruby</span><a class="self-link" href="#ruby-compound"></a></h4>
   <p><i>This section is non-normative</i></p>
   <p>In the simplest examples,
	each <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units⑦">ruby base unit</a> contains only a single character,
	a pattern often used for character-per-character phonetic annotations.
	However, <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units⑧">ruby base units</a> are not restricted
	to containing a single character.
	In some cases it may be impossible
	to map an annotation to the base characters individually,
	and the annotation may need to jointly apply to a group of characters.</p>
   <div class="example" id="grou-ruby-ex">
    <a class="self-link" href="#grou-ruby-ex"></a>
		For example,
		the Japanese word for “today” is written with the characters 今日,
		literally “this”+“day”.
		But it’s pronounced きょう (kyō),
		which can’t be broken down
		into a “this” part
		and a “day” part.


    <p>Therefore phonetic ruby indicating the reading of 今日
		would be marked up as follows:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->今日<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->きょう<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <figure>
		<img alt="“きょう” annotating “今日”" height="71" src="images/group.png" width="87">
		</figure>
   </div>
   <div class="example" id="group-ruby-ex-2">
    <a class="self-link" href="#group-ruby-ex-2"></a>
		Ruby can also be used to describe the meaning of the base text,
		rather than (or in addition to) the pronunciation.
		In such cases,
		both the base text and the annotation
		are typically made of multiple characters,
		with no meaningful subdivision possible.


    <p>Here a compound ideographic word
		has an English-derived synonym
		(written in katakana)
		given as an annotation:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->境界面<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->インターフェース<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <figure>
			<img alt="“インターフェース” annotating “境界面”" height="70" src="images/ruby-interface.png" width="170">
		</figure>
    <p>Here a compound ideographic word
		has its English equivalent
		directly provided as an annotation:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-> <c- e>lang</c-><c- o>=</c-><c- s>"ja"</c-><c- p>></c->編集者<c- p>&lt;</c-><c- f>rt</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->editor<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <figure>
			<img alt="“editor” annotating “編集者”" height="70" src="images/ruby-editor.png" width="130">
		</figure>
   </div>
   <p>In compound words,
	although phonetic annotations might correspond to individual characters,
	they are sometimes nonetheless typeset to share space above the base text,
	rendering similar to annotations on multi-character bases.
	However, there are subtle distinctions in their rendering
	that require encoding the pairing relationships within the compound word
	as well as its identification as a word.
	Furthermore, sharing space in this way
	versus rendering each pair in its own visual “column” is a stylistic preference:
	the markup needs to provide enough information to allow for both renderings
	(as well as correct inlining).</p>
   <div class="example" id="jukugo-ruby">
    <a class="self-link" href="#jukugo-ruby"></a>
		In this example,
		we will use the Japanese noun “<span lang="ja">浄瑠璃</span>” (jōruri),
		a form of traditional Japanese narrative music.
		Its characters are pronounced “じょう”, “る”, and “り”, respectively.
		(Distinct colors shown in these examples for clarity:
		in actual usage there would be no color distinction.)


    <p>Such compound words could be rendered
		with phonetic annotations placed over each character one by one.
		In this style,
		when an annotation is visually longer than the character it annotates,
		surrounding text is pushed apart,
		to make the correspondance between each character and its annotation clear.</p>
    <figure>
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over each of the three characters.
					The first and second character are pushed apart from each other,
					as the annotation over the first one is too long to fit." height="71" src="images/joruri-s.png" width="140">
		</figure>
    <p>However,
		in various typographic traditions,
		it is common to present such a word
		with its annotations sharing space together
		when they would otherwise create a separation in the base text,
		to preserve the implication that it is a single word.
		This style is called “jukugo ruby”
		(“jukugo” meaning “compound word”).</p>
    <figure>
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over the word.
					The characters of each annotation are not alligned
					to their corresponding base,
					instead they are collectively aligned to the whole word." height="71" src="images/joruri-m.png" width="120">
		</figure>
    <p>Even when presenting as “jukugo ruby“ though,
		the annotation are not always merged.
		If a line break occurs in the middle of the word,
		the annotations are expected to remain associated with the correct base character.</p>
    <figure>
			<img alt="“Jōruri” written in horizontal Japanese,
					broken across two lines.
					The phonetic annotations displayed over the word
					are paired with each base character,
					and line break together." height="123" src="images/joruri-lb.png" width="224">
		</figure>
    <p>Whether—and how much—the annotations are merged can vary,
		and can depend on the font size.
		The following figures illustrate two of several possibilities:
		one where “jukugo ruby“ merges an annotation wider than its base
		with the neighboring one
		without necessarily merging them all,
		and one where “jukugo ruby“ merges all annotations
		as soon as any of them is wider than its base.
		No specific layout is mandated by this specification;
		that is under the purview of styling technologies such as CSS.</p>
    <figure>
     
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over each of the three characters.
					At 33% of the base font size,
					annotations are small enough to fit their base character,
					and are aligned to it." height="64" src="images/joruri-33.png" width="119">
			
     <figcaption>Ruby sized at 33%: no merging needed when every annotation fits its base</figcaption>
    </figure>
    <figure>
     
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over each of the three characters.
					At 50% of the base font size,
					the first annotation doesn&apos;t fit over its base character,
					so it merges with the second one.
					The third remains separate." height="71" src="images/joruri-50.png" width="120">
			
     <figcaption>Ruby sized at 50%, variant 1: only merging wide annotations with neighboring ones</figcaption>
    </figure>
    <figure>
     
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over each of the three characters.
					At 50% of the base font size,
					the first annotation doesn&apos;t fit over its base character,
					so all three are merged and aligned together." height="71" src="images/joruri-m.png" width="120">
			
     <figcaption>Ruby sized at 50%, variant 2: merging all annotations as soon as any doesn’t fit its base</figcaption>
    </figure>
    <figure>
     
			<img alt="“Jōruri” written in horizontal Japanese,
					with phonetic annotations over each of the three characters.
					At 60% of the base font size,
					the first annotation doesn&apos;t fit over the first character,
					nor do the first and second together fit over the first two characters.
					All three are merged and aligned together." height="75" src="images/joruri-60.png" width="120">
		
     <figcaption>Ruby sized at 60%: merging necessary in both variants</figcaption>
    </figure>
    <p>Regardless of what rendering variants are made available by the styling technology,
		the same markup needs contain enough information to support any style,
		since choosing whether to render as “jukugo ruby” and its variants is a stylistic choice.
		Markup needs to encode both the pairing information within the word
		as well as the grouping of these pairs as a single word:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->浄<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->瑠<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->璃<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じょう<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->る<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->り<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>Correct “jukugo ruby” is not possible
		if all the base characters are part of a single <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb⑥">rb</a></code> element
		and all the annotation text in a single <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⓪">rt</a></code> element,
		as their individual pairings would be lost.</p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> For more details on Japanese and Chinese ruby usage and rendering,
	see <a data-biblio-display="inline" data-link-type="biblio" href="https://w3c.github.io/jlreq/"><cite>Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)</cite></a>
	(particularly
	<a href="https://w3c.github.io/jlreq/#ruby_and_emphasis_dots">Ruby and Emphasis Dots</a>
	and <a href="https://w3c.github.io/jlreq/#positioning_of_jukugoruby">Appendix F</a>),
	<a data-biblio-display="inline" data-link-type="biblio" href="https://w3c.github.io/simple-ruby/"><cite>Rules for Simple Placement of Japanese Ruby</cite></a>,
	and the section on <a href="https://www.w3.org/International/clreq/#interlinear_annotations">Interlinear annotations</a> of <a data-biblio-display="inline" data-link-type="biblio" href="https://www.w3.org/International/clreq/"><cite>Requirements for Chinese Text Layout - 中文排版需求</cite></a>.</p>
   <h3 class="heading settled" data-level="2.2" id="the-rb-element"><span class="secno">2.2. </span><span class="content">
The <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-rb"><code>rb</code></dfn> element</span><a class="self-link" href="#the-rb-element"></a></h3>
   <dl class="def">
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories" id="ref-for-concept-element-categories①">Categories</a>:
		
    <dd>None.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts" id="ref-for-concept-element-contexts①">Contexts in which this element can be used</a>:
		
    <dd>As a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby⑦">ruby</a></code> element.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model" id="ref-for-concept-element-content-model①">Content model</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2③">Phrasing content</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes①">Content attributes</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes①">Global attributes</a>

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom" id="ref-for-concept-element-dom①">DOM interface</a>:
		
    <dd>Uses <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement①">HTMLElement</a></code>.
	
   </dl>
   <p>An <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb⑦">rb</a></code> (“ruby base”) element
	<span class="w-nodev">that is the child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby⑧">ruby</a></code> element</span>
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents④">represents</a> a <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units⑨">ruby base unit</a>:
	a unitary component of base-level text
	annotated by any ruby annotation(s) to which it is paired.</p>
   <p class="w-nodev">
	An <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb⑧">rb</a></code> element that is not a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby⑨">ruby</a></code> element
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents⑤">represents</a> the same thing as its children.

	</p>
   <div class="example" id="rb-ex">
    <a class="self-link" href="#rb-ex"></a>
		When no <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb⑨">rb</a></code> element is used, the base is implied:

		
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->base<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->annotation<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>The element can also be made explicit:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->base<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->annotation<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>Both markup patterns have identical semantics.
		Explicit <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⓪">rb</a></code> elements can be useful for styling,
		and are necessary
		when marking up consecutive bases to pair with consecutive annotations
		(for example,
		when representing a compound word;
		see <span lang="ja">京都市</span> <a href="#ruby-inlining">inlining</a>
		and <a href="#jukugo-ruby">jukugo ruby</a> examples above).</p>
   </div>
   <h3 class="heading settled" data-level="2.3" id="the-rt-element"><span class="secno">2.3. </span><span class="content">
The <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-rt"><code>rt</code></dfn> element</span><a class="self-link" href="#the-rt-element"></a></h3>
   <dl class="def">
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories" id="ref-for-concept-element-categories②">Categories</a>:
		
    <dd>None.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts" id="ref-for-concept-element-contexts②">Contexts in which this element can be used</a>:
		
    <dd>
			As a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⓪">ruby</a></code>
			or of an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc⑧">rtc</a></code> element.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model" id="ref-for-concept-element-content-model②">Content model</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2④">Phrasing content</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes②">Content attributes</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes②">Global attributes</a>

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations" id="ref-for-concept-element-accessibility-considerations①">Accessibility considerations</a>:
		
    <dd><a href="https://w3c.github.io/html-aria/#el-rt">For authors</a>.
		
    <dd><a href="https://w3c.github.io/html-aam/#el-rt">For implementers</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom" id="ref-for-concept-element-dom②">DOM interface</a>:
		
    <dd>Uses <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement②">HTMLElement</a></code>.
	
   </dl>
   <p>An <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①①">rt</a></code> (“ruby text”) element
	<span class="w-nodev">that is the child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①①">ruby</a></code> element
	or of an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc⑨">rtc</a></code> element
	that is itself the child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①②">ruby</a></code> element</span>
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents⑥">represents</a> a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units①⓪">ruby annotation unit</a>:
	a unitary annotation of the <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units①⓪">ruby base unit</a> to which it is paired.</p>
   <p class="w-nodev">
	An <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①②">rt</a></code> element that is not a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①③">ruby</a></code> element
	nor of an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⓪">rtc</a></code> element
	that is itself the child of a <code>ruby</code> element
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents⑦">represents</a> the same thing as its children.


</p>
   <h3 class="heading settled" data-level="2.4" id="the-rtc-element"><span class="secno">2.4. </span><span class="content">
The <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-rtc"><code>rtc</code></dfn> element</span><a class="self-link" href="#the-rtc-element"></a></h3>
   <dl class="def">
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories" id="ref-for-concept-element-categories③">Categories</a>:
		
    <dd>None.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts" id="ref-for-concept-element-contexts③">Contexts in which this element can be used</a>:
		
    <dd>
			As a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①④">ruby</a></code> element.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model" id="ref-for-concept-element-content-model③">Content model</a>:
		
    <dd>
			Either <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2⑤">phrasing content</a> or a sequence of <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①③">rt</a></code> elements;
			optionally preceded, interleaved with, or followed by individual <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp⑤">rp</a></code> elements.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes③">Content attributes</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes③">Global attributes</a>

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom" id="ref-for-concept-element-dom③">DOM interface</a>:
		
    <dd>Uses <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement③">HTMLElement</a></code>.
	
   </dl>
   <p>An <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①①">rtc</a></code> (“ruby text container”) element
	<span class="w-nodev">that is the child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⑤">ruby</a></code> element</span>
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents⑧">represents</a> one level of annotation
	(a <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range⑧">ruby annotation range</a>)
	for the preceding sequence of <a data-link-type="dfn" href="#ruby-base-units" id="ref-for-ruby-base-units①①">ruby base units</a>
	(its <span>ruby base range</span>).</p>
   <p class="note" role="note"><span class="marker">Note:</span> In simple cases,
	<code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①②">rtc</a></code> elements can be omitted
	as a <a data-link-type="dfn" href="#ruby-annotation-range" id="ref-for-ruby-annotation-range⑨">ruby annotation range</a> is implied
	by consecutive <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①④">rt</a></code> elements.
	However, they are necessary
	in order to associate multiple levels of annotation
	with a single <a data-link-type="dfn" href="#ruby-base-range" id="ref-for-ruby-base-range③">ruby base range</a>,
	for example to provide both phonetic and semantic information,
	phonetic information in different scripts,
	or semantic information in different languages.</p>
   <div class="example" id="ruby-rtc-ex">
    <a class="self-link" href="#ruby-rtc-ex"></a>
		In this example,
		the Japanese compound word 上手 ("skillful")
		has phonetic annotations in both kana and romaji phonetics
		while at the same time maintaining the pairing to bases
		and annotation grouping information.

		
    <figure>
			<img alt="上手 (skill) annotated in both kana and romaji" height="81" src="images/mono-or-jukugo-double.png" width="72">
		</figure>
    <p>This enabled by the following  markup:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->上<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->手<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じよう<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->ず<c- p>&lt;</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rt</c-><c- p>></c->jou<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->zu<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Text that is a direct child of the <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①③">rtc</a></code> element
	implicitly represents a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units①①">ruby annotation unit</a>
	as if it were contained in an <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⑤">rt</a></code> element,
	except that this annotation spans all the bases in the segment.</p>
   <div class="example" id="rtc-ex">
    <a class="self-link" href="#rtc-ex"></a>
		In this example, the Chinese word for San Francisco
		(<span lang="zh-Hans">旧金山</span>, i.e. “old gold mountain”)
		is annotated both using pinyin to give the pronunciation,
		and with the original English.

		
    <figure>
			<img alt="San Francisco in Chinese,
					with both pinyin and the original English as annotations." height="84" src="images/group-double.png" width="113">
		</figure>
    <p>Which is marked up as follows:</p>
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>>&lt;</c-><c- f>rb</c-><c- p>></c->旧<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->金<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->山<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->jiù<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->jīn<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->shān<c- p>&lt;</c-><c- f>rtc</c-><c- p>></c->San Francisco<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>Here, a single base run of three base characters
		is annotated with three pinyin ruby text segments
		in a first (implicit) container,
		and an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①④">rtc</a></code> element is introduced
		in order to provide a second single ruby annotation
		being the city’s English name.</p>
   </div>
   <p class="w-nodev">
	An <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⑤">rtc</a></code> element that is not a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⑥">ruby</a></code> element
	<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents⑨">represents</a> the same thing as its children.


</p>
   <h3 class="heading settled" data-level="2.5" id="the-rp-element"><span class="secno">2.5. </span><span class="content">
The <dfn class="dfn-paneled" data-dfn-type="element" data-export id="elementdef-rp"><code>rp</code></dfn> element</span><a class="self-link" href="#the-rp-element"></a></h3>
   <dl class="def">
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories" id="ref-for-concept-element-categories④">Categories</a>:
		
    <dd>None.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts" id="ref-for-concept-element-contexts④">Contexts in which this element can be used</a>:
		
    <dd>
			As a child of a <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⑦">ruby</a></code> or <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⑥">rtc</a></code> element,
			either immediately before or immediately after an <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⑦">rtc</a></code> element or a <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units①②">ruby annotation unit</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model" id="ref-for-concept-element-content-model④">Content model</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#text-content" id="ref-for-text-content">Text</a>.

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes④">Content attributes</a>:
		
    <dd><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes④">Global attributes</a>

		
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations" id="ref-for-concept-element-accessibility-considerations②">Accessibility considerations</a>:
		
    <dd><a href="https://w3c.github.io/html-aria/#el-rp">For authors</a>.
    <dd><a href="https://w3c.github.io/html-aam/#el-rp">For implementers</a>.
    <dt><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom" id="ref-for-concept-element-dom④">DOM interface</a>:
		
    <dd>Uses <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement④">HTMLElement</a></code>.
	
   </dl>
   <p>The <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp⑥">rp</a></code> (“ruby parenthetical”) element <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#represents" id="ref-for-represents①⓪">represents</a> nothing.
	It is used to provide presentational content
	(such as parentheses)
	around <a data-link-type="dfn" href="#ruby-annotation-units" id="ref-for-ruby-annotation-units①③">ruby annotation units</a>,
	to be shown when presenting ruby content inline,
	without using ruby-specific layout.
	This may happen when using a user agent that does not support ruby layout,
	or for stylistic reasons.
	In typical ruby layout,
	it is not displayed.</p>
   <div class="example" id="rp-ex">
    <a class="self-link" href="#rp-ex"></a>
		In this example,
		each ideograph in the text <span lang="ja">漢字</span>
		is annotated with its phonetic reading.
		Furthermore, it uses <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp⑦">rp</a></code> so that in legacy user agents the readings are in parentheses:

		
<pre lang="ja"><code class="highlight">...<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->漢<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->字<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->（<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->かん<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->じ<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->）<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->...
</code></pre>
    <p>In user agents that support ruby layout,
		the rendering omit the parentheses,
		but in user agents that do not, the rendering would be:</p>
<pre lang="ja">...漢字（かんじ）...</pre>
   </div>
   <div class="example" id="contrieved-rp-ex">
    <a class="self-link" href="#contrieved-rp-ex"></a>
		Here a contrived example
		showing some symbols with names given in English and French
		using double-sided annotations,
		with <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp⑧">rp</a></code> elements as well:

		
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->♥<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->: <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Heart<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->, <c- p>&lt;</c-><c- f>rtc</c-> <c- e>lang</c-><c- o>=</c-><c- s>fr</c-><c- p>></c->Cœur<c- p>&lt;/</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rp</c-><c- p>></c->.<c- p>&lt;/</c-><c- f>rp</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->☘<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->: <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Shamrock<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->, <c- p>&lt;</c-><c- f>rtc</c-> <c- e>lang</c-><c- o>=</c-><c- s>fr</c-><c- p>></c->Trèfle<c- p>&lt;/</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rp</c-><c- p>></c->.<c- p>&lt;/</c-><c- f>rp</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->✶<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->: <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->Star<c- p>&lt;</c-><c- f>rp</c-><c- p>></c->, <c- p>&lt;</c-><c- f>rtc</c-> <c- e>lang</c-><c- o>=</c-><c- s>fr</c-><c- p>></c->Étoile<c- p>&lt;/</c-><c- f>rtc</c-><c- p>>&lt;</c-><c- f>rp</c-><c- p>></c->.<c- p>&lt;/</c-><c- f>rp</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
    <p>This would make the example render as follows in non-ruby-capable user agents:</p>
<pre>♥: Heart, <span lang="fr">Cœur</span>. ☘: Shamrock, <span lang="fr">Trèfle</span>. ✶: Star, <span lang="fr">Étoile</span>.</pre>
   </div>
   <h2 class="heading non-normative settled" data-level="3" id="optional-tags"><span class="secno">3. </span><span class="content">
Optional Tags</span><a class="self-link" href="#optional-tags"></a></h2>
   <div class="advisement">
		This section extends the <a href="https://html.spec.whatwg.org/multipage/syntax.html#optional-tags"><cite>HTML</cite> § 13.1.2.4 Optional tags</a> section of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>,
		replacing the paragraphs of that section about <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⑥">rt</a></code> and <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp⑨">rp</a></code>,
		and adding two more for <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①①">rb</a></code> and <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⑧">rtc</a></code>.
	</div>
   <p>An <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①②">rb</a></code> element’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag" id="ref-for-syntax-end-tag">end tag</a> may be omitted
	if the <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①③">rb</a></code> element is immediately followed by
	an <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①④">rb</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⑦">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc①⑨">rtc</a></code> or <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⓪">rp</a></code> element,
	or if there is no more content in the parent element.</p>
   <p>An <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⑧">rt</a></code> element’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag" id="ref-for-syntax-end-tag①">end tag</a> may be omitted
	if the <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt①⑨">rt</a></code> element is immediately followed by
	an <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⑤">rb</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⓪">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⓪">rtc</a></code> or <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①①">rp</a></code> element,
	or if there is no more content in the parent element.</p>
   <p>An <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②①">rtc</a></code> element’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag" id="ref-for-syntax-end-tag②">end tag</a> may be omitted
	if the <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②②">rtc</a></code> element is immediately followed by
	an <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⑥">rb</a></code> or <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②③">rtc</a></code> element,
	or if there is no more content in the parent element.</p>
   <p>An <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①②">rp</a></code> element’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag" id="ref-for-syntax-end-tag③">end tag</a> may be omitted
	if the <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①③">rp</a></code> element is immediately followed by
	an <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⑦">rb</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②①">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②④">rtc</a></code> or <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①④">rp</a></code> element,
	or if there is no more content in the parent element.</p>
   <h2 class="heading settled" data-level="4" id="rendering"><span class="secno">4. </span><span class="content">
Rendering</span><a class="self-link" href="#rendering"></a></h2>
   <div class="advisement">
    
		This section completes the <a href="https://html.spec.whatwg.org/multipage/rendering.html#non-replaced-elements"><cite>HTML</cite> § 15.3 Non-replaced elements</a> section of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>,
		and in particular its <a href="https://html.spec.whatwg.org/multipage/rendering.html#phrasing-content-3"><cite>HTML</cite> § 15.3.4 Phrasing content</a> subsection,
		with the exception of
		the <code class="highlight">rp <c- p>{</c-> <c- k>display</c-><c- p>:</c-> none<c- p>;</c-> <c- p>}</c-></code> rule
		which belongs in the <a href="https://html.spec.whatwg.org/multipage/rendering.html#hidden-elements"><cite>HTML</cite> § 15.3.1 Hidden elements</a> subsection.


    <p class="note" role="note"><span class="marker">Note:</span> <a href="https://html.spec.whatwg.org/multipage/rendering.html#phrasing-content-3"><cite>HTML</cite> § 15.3.4 Phrasing content</a> contains additional requirements about ruby;
		they are not overridden or invalidated by this specification
		and continue to apply.</p>
   </div>
   <p>The following rules are added
	to the <a href="https://html.spec.whatwg.org/multipage/rendering.html#the-css-user-agent-style-sheet-and-presentational-hints">HTML user agent style sheet</a>:</p>
<pre><code class="highlight">ruby <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby<c- p>;</c-> <c- p>}</c->
rb <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base<c- p>;</c-> <c- k>white-space</c-><c- p>:</c-> nowrap<c- p>;</c-> <c- p>}</c->
rbc <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-base-container<c- p>;</c-> <c- p>}</c-> <c- c>/* For compatibility with XHTML-inspired markup */</c->
rp <c- p>{</c-> <c- k>display</c-><c- p>:</c-> none<c- p>;</c-> <c- p>}</c->
rt <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text<c- p>;</c-> <c- p>}</c->
rtc <c- p>{</c-> <c- k>display</c-><c- p>:</c-> ruby-text-container<c- p>;</c-> <c- p>}</c->
ruby<c- p>,</c-> rb<c- p>,</c-> rbc<c- p>,</c-> rt<c- p>,</c-> rtc <c- p>{</c-> <c- k>unicode-bidi</c-><c- p>:</c-> isolate<c- p>;</c-> <c- p>}</c->
rtc<c- p>,</c-> rt <c- p>{</c->
  <c- k>font-variant-east-asian</c-><c- p>:</c-> ruby<c- p>;</c->
  <c- k>text-emphasis</c-><c- p>:</c-> none<c- p>;</c->
  <c- k>white-space</c-><c- p>:</c-> nowrap<c- p>;</c->
  <c- k>line-height</c-><c- p>:</c-> <c- m>1</c-><c- p>;</c->
<c- p>}</c->
rtc<c- p>,</c-> :not<c- p>(</c->rtc<c- p>)</c-> > rt <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>50</c-><c- k>%</c-><c- p>;</c->
<c- p>}</c->
rtc:lang<c- p>(</c->zh-TW<c- p>),</c-> :not<c- p>(</c->rtc<c- p>)</c-> > rt:lang<c- p>(</c->zh-TW<c- p>)</c-> <c- p>{</c->
    <c- k>font-size</c-><c- p>:</c-> <c- m>30</c-><c- k>%</c-><c- p>;</c->
  <c- p>}</c->
</code></pre>
   <h2 class="heading settled" data-level="5" id="conforming-features"><span class="secno">5. </span><span class="content">
Conforming Features </span><a class="self-link" href="#conforming-features"></a></h2>
   <div class="advisement">
		Even though <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⑧">rb</a></code> and <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⑤">rtc</a></code> are included
		in the list of “entirely obsolete” elements
		which “must not be used by authors”
		in <a href="https://html.spec.whatwg.org/multipage/obsolete.html#non-conforming-features"><cite>HTML</cite> § 16.2 Non-conforming features</a>,
		this specification revokes this obsolete status,
		and deems these two elements fully conforming.
	</div>
   <h2 class="heading no-num non-normative settled" id="html-tweaks"><span class="content">
Appendix A:
Editorial Tweaks to HTML</span><a class="self-link" href="#html-tweaks"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p>In complement to the normative statements made in the main body of this specification,
	this section details additional editorial changes
	that would be desirable to make to the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>
	in order to make it fully align it with what is covered here.</p>
   <ul class="non-normative">
    <li>
     
			Remove the outdated informative description
			of CSS annonymous box generation for ruby bases
			in the following paragraph in <a href="https://html.spec.whatwg.org/multipage/rendering.html#phrasing-content-3"><cite>HTML</cite> § 15.3.4 Phrasing content</a>:

			
     <blockquote>
				For the purposes of the CSS ruby model,
				runs of children of <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⑧">ruby</a></code> elements
				that are not <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②②">rt</a></code> or <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⑤">rp</a></code> elements
				are expected to be wrapped in anonymous boxes
				whose <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display">display</a> property has the value <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-ruby-1/#valdef-display-ruby-base" id="ref-for-valdef-display-ruby-base">ruby-base</a>.
				<a data-link-type="biblio" href="#biblio-css-ruby-1" title="CSS Ruby Annotation Layout Module Level 1">[CSS-RUBY-1]</a>
			</blockquote>
     <p>The matter is already covered in exhaustive detail by <a href="https://drafts.csswg.org/css-ruby-1/#box-fixup"><cite>CSS Ruby Annotation Layout 1</cite> § 2.2 Anonymous Ruby Box Generation</a>.</p>
    <li>
     
			Replace the following note in <a href="https://html.spec.whatwg.org/multipage/rendering.html#phrasing-content-3"><cite>HTML</cite> § 15.3.4 Phrasing content</a>:

			
     <blockquote>
      <del>
       <p class="note" role="note"><span class="marker">Note:</span> When it becomes possible to do so,
					the preceding requirement will be updated to be expressed in terms of CSS ruby.
					(Currently, CSS ruby does not handle nested <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby①⑨">ruby</a></code> elements
					or multiple sequential <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②③">rt</a></code> elements,
					which is how this semantic is expressed.)</p>
      </del>
      <ins>
       <p class="note" role="note"><span class="marker">Note:</span> In CSS, this is achieved by default:
					the initial value of the <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-ruby-1/#propdef-ruby-position" id="ref-for-propdef-ruby-position">ruby-position</a> property
					is <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-ruby-1/#valdef-ruby-position-alternate" id="ref-for-valdef-ruby-position-alternate">alternate</a>,
					which produces this effect.</p>
      </ins>
     </blockquote>
    <li>
     
			Replacing the <q><code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②⓪">ruby</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②④">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⑥">rp</a></code></q> row of the table in <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#usage-summary"><cite>HTML</cite> § 4.5.29 Usage summary</a>,
			with the following:

			
     <table class="complex data">
      <thead>
       <tr>
        <th>Element
						
        <th>Purpose
						
        <th>Example
				
      <tbody>
       <tr>
        <td><code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②①">ruby</a></code>, <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb①⑨">rb</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⑤">rt</a></code>, <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⑥">rtc</a></code>, <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⑦">rp</a></code>
						
        <td>Ruby annotations
						
        <td><code class="highlight">
						<c- p>&lt;</c-><c- f>ruby</c-><c- p>></c-><wbr><c- p>&lt;</c-><c- f>rb</c-><c- p>></c-><wbr>旧<c- p>&lt;</c-><c- f>rb</c-><c- p>></c-><wbr>金<c- p>&lt;</c-><c- f>rb</c-><c- p>></c-><wbr>山<c- p>&lt;</c-><c- f>rp</c-><c- p>></c-><wbr> (<c- p>&lt;</c-><c- f>rt</c-><c- p>></c-><wbr>jiù<c- p>&lt;</c-><c- f>rt</c-><c- p>></c-><wbr>jīn<c- p>&lt;</c-><c- f>rt</c-><c- p>></c-><wbr>shān<c- p>&lt;</c-><c- f>rtc</c-><c- p>></c-><wbr><c- p>&lt;</c-><c- f>rp</c-><c- p>></c-><wbr>: <c- p>&lt;/</c-><c- f>rp</c-><c- p>></c-><wbr>San Francisco<c- p>&lt;/</c-><c- f>rtc</c-><c- p>></c-><wbr><c- p>&lt;</c-><c- f>rp</c-><c- p>></c-><wbr>)<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
						</code>
			
     </table>
    <li>
     
			Updating the table at <a href="https://html.spec.whatwg.org/multipage/indices.html#elements-3"><cite>HTML</cite> §  Elements</a>
			to add rows for  <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②⓪">rb</a></code> and <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⑦">rtc</a></code>,
			and to replace the rows for <code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⑧">rp</a></code>, <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⑥">rt</a></code>, and <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②②">ruby</a></code>,
			as follows:

			
     <table class="complex data">
      <thead>
       <tr>
        <th>Element
						
        <th>Description
						
        <th>Categories
						
        <th>Parents†
						
        <th>Children
						
        <th>Attributes
						
        <th>Interface
				
      <tbody>
       <tr>
        <th><code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②①">rb</a></code>
						
        <td>Ruby base
						
        <td>none
						
        <td><code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②③">ruby</a></code>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2⑥">phrasing</a>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes⑤">globals</a>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement⑤">HTMLElement</a></code>
					
       <tr>
        <th><code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp①⑨">rp</a></code>
						
        <td>Parenthesis for ruby annotation text
						
        <td>none
						
        <td><code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②④">ruby</a></code>; <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⑧">rtc</a></code>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#text-content" id="ref-for-text-content①">text</a>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes⑥">globals</a>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement⑥">HTMLElement</a></code>
					
       <tr>
        <th><code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⑦">rt</a></code>
						
        <td>Ruby annotation text
						
        <td>none
						
        <td>
							<code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②⑤">ruby</a></code>;
							<code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc②⑨">rtc</a></code>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2⑦">phrasing</a>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes⑦">globals</a>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement⑦">HTMLElement</a></code>
					
       <tr>
        <th><code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③⓪">rtc</a></code>
						
        <td>Ruby annotation container
						
        <td>none
						
        <td> <code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②⑥">ruby</a></code>
						
        <td>
							<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2⑧">phrasing</a>;
							<code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⑧">rt</a></code>;
							<code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp②⓪">rp</a></code>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes⑧">globals</a>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement⑧">HTMLElement</a></code>
					
       <tr>
        <th><code><a data-link-type="element" href="#elementdef-ruby" id="ref-for-elementdef-ruby②⑦">ruby</a></code>
						
        <td>Ruby annotation(s)
						
        <td>
							<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#flow-content-2" id="ref-for-flow-content-2①">flow</a>;
							<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2⑨">phrasing</a>;
							<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#palpable-content-2" id="ref-for-palpable-content-2①">palpable</a>
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2①⓪">phrasing</a>
						
        <td>
							<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2" id="ref-for-phrasing-content-2①①">phrasing</a>;
							<code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②②">rb</a></code>;
							<code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt②⑨">rt</a></code>;
							<code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③①">rtc</a></code>;
							<code><a data-link-type="element" href="#elementdef-rp" id="ref-for-elementdef-rp②①">rp</a></code>*
						
        <td><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#global-attributes" id="ref-for-global-attributes⑨">globals</a>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement⑨">HTMLElement</a></code>
			
     </table>
    <li>
     
			Updating the table at <a href="https://html.spec.whatwg.org/multipage/indices.html#element-interfaces"><cite>HTML</cite> §  Element interfaces</a>
			to add the following two rows:

			
     <table class="complex data">
      <thead>
       <tr>
        <th>Element(s)
						
        <th>Interface(s)
				
      <tbody>
       <tr>
        <td><code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②③">rb</a></code>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement①⓪">HTMLElement</a></code>
					
       <tr>
        <td><code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③②">rtc</a></code>
						
        <td><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement" id="ref-for-htmlelement①①">HTMLElement</a></code>
			
     </table>
   </ul>
   <h2 class="heading no-num settled" id="diff-html"><span class="content">
Appendix B:
Comparison With The HTML Standard</span><a class="self-link" href="#diff-html"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p class="note" role="note"><span class="marker">Note:</span> This comparison is based on the state of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>
	at the time of writing this document.
	If the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a> adopts some or all of the changes described here,
	or otherwise evolves its handling of ruby,
	this section is expected to be updated accordingly,
	but there could be a delay before this happens.</p>
   <p>While this specification reintroduces the previously obsoleted <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②④">rb</a></code> and <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③③">rtc</a></code> elements,
	it makes no changes to <a href="https://html.spec.whatwg.org/multipage/parsing.html#parsing"><cite>HTML</cite> § 13.2 Parsing HTML documents</a>:
	these elements are handled there already,
	including their optional end tags.</p>
   <p>There are, however, differences in how the various ruby related elements can be used,
	the two essential ones being:</p>
   <ol>
    <li>
     
			In addition to the ability to interleave <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt③⓪">rt</a></code> elements between anonymous ruby bases,
			the previously obsoleted <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②⑤">rb</a></code> element is restored,
			enabling the so-called <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="tabular-markup">tabular markup</dfn> pattern
			where several consecutive bases are followed
			their respective annotations:

			
<pre><code class="highlight"><c- p>&lt;</c-><c- f>ruby</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>rb</c-><c- p>></c->…<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->…<c- p>&lt;</c-><c- f>rb</c-><c- p>></c->…
  <c- p>&lt;</c-><c- f>rt</c-><c- p>></c->…<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->…<c- p>&lt;</c-><c- f>rt</c-><c- p>></c->…
<c- p>&lt;/</c-><c- f>ruby</c-><c- p>></c->
</code></pre>
     <p>Without <code><a data-link-type="element" href="#elementdef-rb" id="ref-for-elementdef-rb②⑥">rb</a></code> and <a data-link-type="dfn" href="#tabular-markup" id="ref-for-tabular-markup">tabular markup</a>,
			in order to have the individual base/annotation pairing
			necessary to correct handle
			the various possible presentations of ruby on <a href="#jukugo-ruby">compound words</a>,
			interleaving the <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt③①">rt</a></code> elements between segments of base text would be required.
			However, such this markup would not enable correct <a href="#ruby-inlining">ruby inlining</a>.</p>
     <p>Moreover, interleaved markup is also a source of issues
			with operations like
			copy&amp;paste,
			searching through the document,
			or speech synthesis,
			due to the base text being interrupted by the annotations.</p>
    <li>
     
			This document defines a different model for handling multiple levels of annotations:
			
     <ul>
      <li>
       
					The ability to associate multiple consecutive <code><a data-link-type="element" href="#elementdef-rt" id="ref-for-elementdef-rt③②">rt</a></code> elements with the preceding base text segment
					without using explicit annotation containers
					is dropped.
					This pattern does not have interoperable implementations with the semantics intended by the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>,
					and is in tension with <a data-link-type="dfn" href="#tabular-markup" id="ref-for-tabular-markup①">tabular markup</a>.


       <p>Instead, the previously obsoleted <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③④">rtc</a></code> element is restored,
					providing the ability to indicate multiple annotation ranges over the same base(s),
					using either interleaved or <a data-link-type="dfn" href="#tabular-markup" id="ref-for-tabular-markup②">tabular markup</a> patterns.</p>
      <li>
       
					While the ability to nest ruby is retained,
					specialized semantics for nested ruby are dropped.
					That markup pattern is strictly less expressive
					than using <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③⑤">rtc</a></code> for additional levels of annotations,
					since it does not allow pairing individual annotations in the outer ruby
					with individual bases in the inner ruby.
					The <a href="#ruby-rtc-ex">example about “上手”</a>
					can therefore be realized using <code><a data-link-type="element" href="#elementdef-rtc" id="ref-for-elementdef-rtc③⑥">rtc</a></code>
					but could not be with nested ruby.


       <p>Nested ruby as defined in the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a> also does not have interoperable implementations
					beyond the ordinary semantics of nesting,
					and is at odds with the layout model of <a data-biblio-display="inline" data-link-type="biblio" href="https://drafts.csswg.org/css-ruby-1/"><cite>CSS Ruby Annotation Layout Module Level 1</cite></a>.</p>
     </ul>
   </ol>
   <p>A <a data-biblio-display="inline" data-link-type="biblio" href="https://fantasai.inkedblade.net/weblog/2011/ruby/">2011 blog post by fantasai</a> explains in more details
	these requirements and resulting design choices.</p>
   <h2 class="heading no-num settled" id="sec"><span class="content">
Appendix C:
Security Considerations</span><a class="self-link" href="#sec"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p>This specification has no known security implication.</p>
   <h2 class="heading no-num settled" id="priv"><span class="content">
Appendix D:
Privacy Considerations</span><a class="self-link" href="#priv"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p>This specification has no known privacy implication.</p>
   <h2 class="heading no-num settled" id="ack"><span class="content">
Appendix E:
Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p><i>This section is non-normative</i></p>
   <p>This document derives from several sources (which to some degree also derive from each other).
	We would like to thank the contributors to all these sources, notably:</p>
   <ul>
    <li data-md>
     <p>The many <a href="https://html.spec.whatwg.org/multipage/acknowledgements.html#ipr">editors and contributors</a> of the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a></p>
    <li data-md>
     <p>Robin Berjon, editor of the previous version of <a href="https://www.w3.org/TR/2014/NOTE-html-ruby-extensions-20140204/">W3C HTML Ruby Markup Extensions</a></p>
    <li data-md>
     <p>The editors and <a href="https://www.w3.org/TR/ruby/#ack">contributors</a> of <a data-biblio-display="inline" data-link-type="biblio" href="https://www.w3.org/TR/ruby/"><cite>Ruby Annotation</cite></a></p>
   </ul>
   <p>In addition,
	none of this would be possible without the expert input,
	many years of research,
	and extensive documentation
	by the participants of the <a href="https://www.w3.org/groups/wg/i18n-core/">Internationalization Working Group</a>,
	notably:</p>
   <ul>
    <li data-md>
     <p>The many contributors to <a data-biblio-display="inline" data-link-type="biblio" href="https://w3c.github.io/jlreq/"><cite>Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)</cite></a></p>
    <li data-md>
     <p>The many contributors to <a data-biblio-display="inline" data-link-type="biblio" href="https://www.w3.org/International/clreq/"><cite>Requirements for Chinese Text Layout - 中文排版需求</cite></a></p>
    <li data-md>
     <p>Richard Ishida</p>
    <li data-md>
     <p>Elika J. Etemad (aka. fantasai)</p>
   </ul>
   <h2 class="heading no-num settled" id="changes"><span class="content">
Appendix F:
Changes</span><a class="self-link" href="#changes"></a></h2>
   <p><i>This section is non-normative</i></p>
   <h3 class="heading settled" id="changes-since-2024-05-wd"><span class="content">
Changes since the 07 May 2024 Working Draft</span><a class="self-link" href="#changes-since-2024-05-wd"></a></h3>
   <p>Significant changes since the <a href="https://www.w3.org/TR/2024/WD-html-ruby-extensions-20240507/">07 May 2024 Working Draft</a>:</p>
   <ul>
    <li data-md>
     <p>None yet.</p>
   </ul>
   <h3 class="heading settled" id="changes-since-2014"><span class="content">
Changes since the 04 February 2014 <cite>W3C HTML Ruby Markup Extensions</cite> Working Group Note
</span><a class="self-link" href="#changes-since-2014"></a></h3>
   <p>The markup model described here
	is substantially the same as the one established by the <a href="https://www.w3.org/TR/2014/NOTE-html-ruby-extensions-20140204/">2014 Working Group Note</a>,
	though the text describing it,
	as well as the examples,
	has been extensively reworked.</p>
   <p>The <a href="https://www.w3.org/TR/2014/NOTE-html-ruby-extensions-20140204/#parsing-changes">parsing changes</a> proposed in the 2014 Working Group Note
	are no longer discussed here
	as they have since been adopted by the <a data-biblio-display="inline" data-link-type="biblio" href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="heading no-num no-ref settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="heading no-num no-ref settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification.

    </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>

    </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this:

    </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a>
        
    <p>This is an example of an informative example.
    </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this:

    </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="heading no-num no-ref settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm.

    </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize.
</p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#annotation-pairing">annotation pairing</a><span>, in § 2.1.1</span>
   <li><a href="#ruby-annotation-range">annotation range</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-units">annotation unit</a><span>, in § 2.1.1</span>
   <li><a href="#ruby-base-range">base range</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-units">base unit</a><span>, in § 2.1.1</span>
   <li><a href="#elementdef-rb">rb</a><span>, in § 2.2</span>
   <li><a href="#elementdef-rp">rp</a><span>, in § 2.5</span>
   <li><a href="#elementdef-rt">rt</a><span>, in § 2.3</span>
   <li><a href="#elementdef-rtc">rtc</a><span>, in § 2.4</span>
   <li><a href="#ruby">Ruby</a><span>, in § 1</span>
   <li><a href="#elementdef-ruby">ruby</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-range">ruby annotation range</a><span>, in § 2.1</span>
   <li><a href="#ruby-annotation-units">ruby annotation units</a><span>, in § 2.1.1</span>
   <li><a href="#ruby-base-range">ruby base range</a><span>, in § 2.1</span>
   <li><a href="#ruby-base-units">ruby base units</a><span>, in § 2.1.1</span>
   <li><a href="#ruby-segment">ruby segment</a><span>, in § 2.1.1</span>
   <li><a href="#tabular-markup">tabular markup</a><span>, in § Unnumbered section</span>
  </ul>
  <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e7f0dd6c">display</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-RUBY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2cb0b95d">alternate</span>
     <li><span class="dfn-paneled" id="19a86e72">ruby-base</span>
     <li><span class="dfn-paneled" id="dd21c139">ruby-position</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b08d0bb2">HTMLElement</span>
     <li><span class="dfn-paneled" id="5fd912e7">accessibility considerations</span>
     <li><span class="dfn-paneled" id="dfc4f7e7">categories</span>
     <li><span class="dfn-paneled" id="68675e70">content attributes</span>
     <li><span class="dfn-paneled" id="88766833">content model</span>
     <li><span class="dfn-paneled" id="3c915747">contexts in which this element can be used</span>
     <li><span class="dfn-paneled" id="317acf49">DOM interface</span>
     <li><span class="dfn-paneled" id="2ffaee93">end tags</span>
     <li><span class="dfn-paneled" id="1236ac1a">flow content</span>
     <li><span class="dfn-paneled" id="8fc74046">global attributes</span>
     <li><span class="dfn-paneled" id="cb3fd7c7">inter-element whitespace</span>
     <li><span class="dfn-paneled" id="d54eeea2">palpable content</span>
     <li><span class="dfn-paneled" id="e5a7e26c">phrasing content</span>
     <li><span class="dfn-paneled" id="073cf09c">represent</span>
     <li><span class="dfn-paneled" id="62ac5b1c">text</span>
    </ul>
  </ul>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-clreq">[CLREQ]
   <dd>Fuqiao Xue; Richard Ishida. <a href="https://www.w3.org/International/clreq/"><cite>Requirements for Chinese Text Layout - 中文排版需求</cite></a>. URL: <a href="https://www.w3.org/International/clreq/">https://www.w3.org/International/clreq/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-ruby-1">[CSS-RUBY-1]
   <dd>Elika Etemad; et al. <a href="https://drafts.csswg.org/css-ruby-1/"><cite>CSS Ruby Annotation Layout Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-ruby-1/">https://drafts.csswg.org/css-ruby-1/</a>
   <dt id="biblio-jlreq">[JLREQ]
   <dd>Hiroyuki Chiba; et al. <a href="https://w3c.github.io/jlreq/"><cite>Requirements for Japanese Text Layout 日本語組版処理の要件(日本語版)</cite></a>. URL: <a href="https://w3c.github.io/jlreq/">https://w3c.github.io/jlreq/</a>
   <dt id="biblio-qa-ruby">[QA-RUBY]
   <dd>Richard Ishida. <a href="https://www.w3.org/International/questions/qa-ruby"><cite>What is ruby?</cite></a>. URL: <a href="https://www.w3.org/International/questions/qa-ruby">https://www.w3.org/International/questions/qa-ruby</a>
   <dt id="biblio-ruby">[RUBY]
   <dd>Marcin Sawicki; et al. <a href="https://www.w3.org/TR/ruby/"><cite>Ruby Annotation</cite></a>. 31 May 2001. REC. URL: <a href="https://www.w3.org/TR/ruby/">https://www.w3.org/TR/ruby/</a>
   <dt id="biblio-simple-ruby">[SIMPLE-RUBY]
   <dd>Florian Rivoal; Atsushi Shimono; Richard Ishida. <a href="https://w3c.github.io/simple-ruby/"><cite>Rules for Simple Placement of Japanese Ruby</cite></a>. URL: <a href="https://w3c.github.io/simple-ruby/">https://w3c.github.io/simple-ruby/</a>
   <dt id="biblio-unified-ruby">[UNIFIED-RUBY]
   <dd>Elika J. Etemad. <a href="https://fantasai.inkedblade.net/weblog/2011/ruby/"><cite>Towards a Unified Ruby Model</cite></a>. URL: <a href="https://fantasai.inkedblade.net/weblog/2011/ruby/">https://fantasai.inkedblade.net/weblog/2011/ruby/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"073cf09c": {"dfnID":"073cf09c","dfnText":"represent","external":true,"refSections":[{"refs":[{"id":"ref-for-represents"},{"id":"ref-for-represents\u2460"},{"id":"ref-for-represents\u2461"},{"id":"ref-for-represents\u2462"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-represents\u2463"},{"id":"ref-for-represents\u2464"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-represents\u2465"},{"id":"ref-for-represents\u2466"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-represents\u2467"},{"id":"ref-for-represents\u2468"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-represents\u2460\u24ea"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#represents"},
"1236ac1a": {"dfnID":"1236ac1a","dfnText":"flow content","external":true,"refSections":[{"refs":[{"id":"ref-for-flow-content-2"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-flow-content-2\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#flow-content-2"},
"19a86e72": {"dfnID":"19a86e72","dfnText":"ruby-base","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-display-ruby-base"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://drafts.csswg.org/css-ruby-1/#valdef-display-ruby-base"},
"2cb0b95d": {"dfnID":"2cb0b95d","dfnText":"alternate","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-ruby-position-alternate"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://drafts.csswg.org/css-ruby-1/#valdef-ruby-position-alternate"},
"2ffaee93": {"dfnID":"2ffaee93","dfnText":"end tags","external":true,"refSections":[{"refs":[{"id":"ref-for-syntax-end-tag"},{"id":"ref-for-syntax-end-tag\u2460"},{"id":"ref-for-syntax-end-tag\u2461"},{"id":"ref-for-syntax-end-tag\u2462"}],"title":"3. \nOptional Tags"}],"url":"https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag"},
"317acf49": {"dfnID":"317acf49","dfnText":"DOM interface","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-dom"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-dom\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-concept-element-dom\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-dom\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-concept-element-dom\u2463"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom"},
"3c915747": {"dfnID":"3c915747","dfnText":"contexts in which this element can be used","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-contexts"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-contexts\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-concept-element-contexts\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-contexts\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-concept-element-contexts\u2463"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts"},
"5fd912e7": {"dfnID":"5fd912e7","dfnText":"accessibility considerations","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-accessibility-considerations"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-accessibility-considerations\u2460"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-accessibility-considerations\u2461"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations"},
"62ac5b1c": {"dfnID":"62ac5b1c","dfnText":"text","external":true,"refSections":[{"refs":[{"id":"ref-for-text-content"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-text-content\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#text-content"},
"68675e70": {"dfnID":"68675e70","dfnText":"content attributes","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-attributes"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-attributes\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-concept-element-attributes\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-attributes\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-concept-element-attributes\u2463"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes"},
"88766833": {"dfnID":"88766833","dfnText":"content model","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-content-model"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-content-model\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-concept-element-content-model\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-content-model\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-concept-element-content-model\u2463"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model"},
"8fc74046": {"dfnID":"8fc74046","dfnText":"global attributes","external":true,"refSections":[{"refs":[{"id":"ref-for-global-attributes"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-global-attributes\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-global-attributes\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-global-attributes\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-global-attributes\u2463"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-global-attributes\u2464"},{"id":"ref-for-global-attributes\u2465"},{"id":"ref-for-global-attributes\u2466"},{"id":"ref-for-global-attributes\u2467"},{"id":"ref-for-global-attributes\u2468"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#global-attributes"},
"annotation-pairing": {"dfnID":"annotation-pairing","dfnText":"annotation pairing","external":false,"refSections":[],"url":"#annotation-pairing"},
"b08d0bb2": {"dfnID":"b08d0bb2","dfnText":"HTMLElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlelement"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-htmlelement\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-htmlelement\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-htmlelement\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-htmlelement\u2463"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-htmlelement\u2464"},{"id":"ref-for-htmlelement\u2465"},{"id":"ref-for-htmlelement\u2466"},{"id":"ref-for-htmlelement\u2467"},{"id":"ref-for-htmlelement\u2468"},{"id":"ref-for-htmlelement\u2460\u24ea"},{"id":"ref-for-htmlelement\u2460\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#htmlelement"},
"cb3fd7c7": {"dfnID":"cb3fd7c7","dfnText":"inter-element whitespace","external":true,"refSections":[{"refs":[{"id":"ref-for-inter-element-whitespace"}],"title":"2.1.1. \nRuby Segmentation and Pairing"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#inter-element-whitespace"},
"d54eeea2": {"dfnID":"d54eeea2","dfnText":"palpable content","external":true,"refSections":[{"refs":[{"id":"ref-for-palpable-content-2"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-palpable-content-2\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#palpable-content-2"},
"dd21c139": {"dfnID":"dd21c139","dfnText":"ruby-position","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-ruby-position"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://drafts.csswg.org/css-ruby-1/#propdef-ruby-position"},
"dfc4f7e7": {"dfnID":"dfc4f7e7","dfnText":"categories","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-categories"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-concept-element-categories\u2460"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-concept-element-categories\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-concept-element-categories\u2462"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-concept-element-categories\u2463"}],"title":"2.5. \nThe rp element"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories"},
"e5a7e26c": {"dfnID":"e5a7e26c","dfnText":"phrasing content","external":true,"refSections":[{"refs":[{"id":"ref-for-phrasing-content-2"},{"id":"ref-for-phrasing-content-2\u2460"},{"id":"ref-for-phrasing-content-2\u2461"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-phrasing-content-2\u2462"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-phrasing-content-2\u2463"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-phrasing-content-2\u2464"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-phrasing-content-2\u2465"},{"id":"ref-for-phrasing-content-2\u2466"},{"id":"ref-for-phrasing-content-2\u2467"},{"id":"ref-for-phrasing-content-2\u2468"},{"id":"ref-for-phrasing-content-2\u2460\u24ea"},{"id":"ref-for-phrasing-content-2\u2460\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2"},
"e7f0dd6c": {"dfnID":"e7f0dd6c","dfnText":"display","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-display"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"elementdef-rb": {"dfnID":"elementdef-rb","dfnText":"rb","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-rb"},{"id":"ref-for-elementdef-rb\u2460"},{"id":"ref-for-elementdef-rb\u2461"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-elementdef-rb\u2462"},{"id":"ref-for-elementdef-rb\u2463"},{"id":"ref-for-elementdef-rb\u2464"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-elementdef-rb\u2465"}],"title":"2.1.2. \nMarkup Patterns for Multi-Character Ruby"},{"refs":[{"id":"ref-for-elementdef-rb\u2466"},{"id":"ref-for-elementdef-rb\u2467"},{"id":"ref-for-elementdef-rb\u2468"},{"id":"ref-for-elementdef-rb\u2460\u24ea"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-elementdef-rb\u2460\u2460"},{"id":"ref-for-elementdef-rb\u2460\u2461"},{"id":"ref-for-elementdef-rb\u2460\u2462"},{"id":"ref-for-elementdef-rb\u2460\u2463"},{"id":"ref-for-elementdef-rb\u2460\u2464"},{"id":"ref-for-elementdef-rb\u2460\u2465"},{"id":"ref-for-elementdef-rb\u2460\u2466"}],"title":"3. \nOptional Tags"},{"refs":[{"id":"ref-for-elementdef-rb\u2460\u2467"}],"title":"5. \nConforming Features "},{"refs":[{"id":"ref-for-elementdef-rb\u2460\u2468"},{"id":"ref-for-elementdef-rb\u2461\u24ea"},{"id":"ref-for-elementdef-rb\u2461\u2460"},{"id":"ref-for-elementdef-rb\u2461\u2461"},{"id":"ref-for-elementdef-rb\u2461\u2462"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"},{"refs":[{"id":"ref-for-elementdef-rb\u2461\u2463"},{"id":"ref-for-elementdef-rb\u2461\u2464"},{"id":"ref-for-elementdef-rb\u2461\u2465"}],"title":"\nAppendix B:\nComparison With The HTML Standard"}],"url":"#elementdef-rb"},
"elementdef-rp": {"dfnID":"elementdef-rp","dfnText":"rp","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-rp"},{"id":"ref-for-elementdef-rp\u2460"},{"id":"ref-for-elementdef-rp\u2461"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-elementdef-rp\u2462"},{"id":"ref-for-elementdef-rp\u2463"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-elementdef-rp\u2464"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-elementdef-rp\u2465"},{"id":"ref-for-elementdef-rp\u2466"},{"id":"ref-for-elementdef-rp\u2467"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-elementdef-rp\u2468"},{"id":"ref-for-elementdef-rp\u2460\u24ea"},{"id":"ref-for-elementdef-rp\u2460\u2460"},{"id":"ref-for-elementdef-rp\u2460\u2461"},{"id":"ref-for-elementdef-rp\u2460\u2462"},{"id":"ref-for-elementdef-rp\u2460\u2463"}],"title":"3. \nOptional Tags"},{"refs":[{"id":"ref-for-elementdef-rp\u2460\u2464"},{"id":"ref-for-elementdef-rp\u2460\u2465"},{"id":"ref-for-elementdef-rp\u2460\u2466"},{"id":"ref-for-elementdef-rp\u2460\u2467"},{"id":"ref-for-elementdef-rp\u2460\u2468"},{"id":"ref-for-elementdef-rp\u2461\u24ea"},{"id":"ref-for-elementdef-rp\u2461\u2460"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"#elementdef-rp"},
"elementdef-rt": {"dfnID":"elementdef-rt","dfnText":"rt","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-rt"},{"id":"ref-for-elementdef-rt\u2460"},{"id":"ref-for-elementdef-rt\u2461"},{"id":"ref-for-elementdef-rt\u2462"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-elementdef-rt\u2463"},{"id":"ref-for-elementdef-rt\u2464"},{"id":"ref-for-elementdef-rt\u2465"},{"id":"ref-for-elementdef-rt\u2466"},{"id":"ref-for-elementdef-rt\u2467"},{"id":"ref-for-elementdef-rt\u2468"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-elementdef-rt\u2460\u24ea"}],"title":"2.1.2. \nMarkup Patterns for Multi-Character Ruby"},{"refs":[{"id":"ref-for-elementdef-rt\u2460\u2460"},{"id":"ref-for-elementdef-rt\u2460\u2461"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-elementdef-rt\u2460\u2462"},{"id":"ref-for-elementdef-rt\u2460\u2463"},{"id":"ref-for-elementdef-rt\u2460\u2464"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-elementdef-rt\u2460\u2465"},{"id":"ref-for-elementdef-rt\u2460\u2466"},{"id":"ref-for-elementdef-rt\u2460\u2467"},{"id":"ref-for-elementdef-rt\u2460\u2468"},{"id":"ref-for-elementdef-rt\u2461\u24ea"},{"id":"ref-for-elementdef-rt\u2461\u2460"}],"title":"3. \nOptional Tags"},{"refs":[{"id":"ref-for-elementdef-rt\u2461\u2461"},{"id":"ref-for-elementdef-rt\u2461\u2462"},{"id":"ref-for-elementdef-rt\u2461\u2463"},{"id":"ref-for-elementdef-rt\u2461\u2464"},{"id":"ref-for-elementdef-rt\u2461\u2465"},{"id":"ref-for-elementdef-rt\u2461\u2466"},{"id":"ref-for-elementdef-rt\u2461\u2467"},{"id":"ref-for-elementdef-rt\u2461\u2468"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"},{"refs":[{"id":"ref-for-elementdef-rt\u2462\u24ea"},{"id":"ref-for-elementdef-rt\u2462\u2460"},{"id":"ref-for-elementdef-rt\u2462\u2461"}],"title":"\nAppendix B:\nComparison With The HTML Standard"}],"url":"#elementdef-rt"},
"elementdef-rtc": {"dfnID":"elementdef-rtc","dfnText":"rtc","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-rtc"},{"id":"ref-for-elementdef-rtc\u2460"},{"id":"ref-for-elementdef-rtc\u2461"},{"id":"ref-for-elementdef-rtc\u2462"},{"id":"ref-for-elementdef-rtc\u2463"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-elementdef-rtc\u2464"},{"id":"ref-for-elementdef-rtc\u2465"},{"id":"ref-for-elementdef-rtc\u2466"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-elementdef-rtc\u2467"},{"id":"ref-for-elementdef-rtc\u2468"},{"id":"ref-for-elementdef-rtc\u2460\u24ea"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-elementdef-rtc\u2460\u2460"},{"id":"ref-for-elementdef-rtc\u2460\u2461"},{"id":"ref-for-elementdef-rtc\u2460\u2462"},{"id":"ref-for-elementdef-rtc\u2460\u2463"},{"id":"ref-for-elementdef-rtc\u2460\u2464"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-elementdef-rtc\u2460\u2465"},{"id":"ref-for-elementdef-rtc\u2460\u2466"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-elementdef-rtc\u2460\u2467"},{"id":"ref-for-elementdef-rtc\u2460\u2468"},{"id":"ref-for-elementdef-rtc\u2461\u24ea"},{"id":"ref-for-elementdef-rtc\u2461\u2460"},{"id":"ref-for-elementdef-rtc\u2461\u2461"},{"id":"ref-for-elementdef-rtc\u2461\u2462"},{"id":"ref-for-elementdef-rtc\u2461\u2463"}],"title":"3. \nOptional Tags"},{"refs":[{"id":"ref-for-elementdef-rtc\u2461\u2464"}],"title":"5. \nConforming Features "},{"refs":[{"id":"ref-for-elementdef-rtc\u2461\u2465"},{"id":"ref-for-elementdef-rtc\u2461\u2466"},{"id":"ref-for-elementdef-rtc\u2461\u2467"},{"id":"ref-for-elementdef-rtc\u2461\u2468"},{"id":"ref-for-elementdef-rtc\u2462\u24ea"},{"id":"ref-for-elementdef-rtc\u2462\u2460"},{"id":"ref-for-elementdef-rtc\u2462\u2461"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"},{"refs":[{"id":"ref-for-elementdef-rtc\u2462\u2462"},{"id":"ref-for-elementdef-rtc\u2462\u2463"},{"id":"ref-for-elementdef-rtc\u2462\u2464"},{"id":"ref-for-elementdef-rtc\u2462\u2465"}],"title":"\nAppendix B:\nComparison With The HTML Standard"}],"url":"#elementdef-rtc"},
"elementdef-ruby": {"dfnID":"elementdef-ruby","dfnText":"ruby","external":false,"refSections":[{"refs":[{"id":"ref-for-elementdef-ruby"},{"id":"ref-for-elementdef-ruby\u2460"},{"id":"ref-for-elementdef-ruby\u2461"},{"id":"ref-for-elementdef-ruby\u2462"},{"id":"ref-for-elementdef-ruby\u2463"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-elementdef-ruby\u2464"},{"id":"ref-for-elementdef-ruby\u2465"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-elementdef-ruby\u2466"},{"id":"ref-for-elementdef-ruby\u2467"},{"id":"ref-for-elementdef-ruby\u2468"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-elementdef-ruby\u2460\u24ea"},{"id":"ref-for-elementdef-ruby\u2460\u2460"},{"id":"ref-for-elementdef-ruby\u2460\u2461"},{"id":"ref-for-elementdef-ruby\u2460\u2462"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-elementdef-ruby\u2460\u2463"},{"id":"ref-for-elementdef-ruby\u2460\u2464"},{"id":"ref-for-elementdef-ruby\u2460\u2465"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-elementdef-ruby\u2460\u2466"}],"title":"2.5. \nThe rp element"},{"refs":[{"id":"ref-for-elementdef-ruby\u2460\u2467"},{"id":"ref-for-elementdef-ruby\u2460\u2468"},{"id":"ref-for-elementdef-ruby\u2461\u24ea"},{"id":"ref-for-elementdef-ruby\u2461\u2460"},{"id":"ref-for-elementdef-ruby\u2461\u2461"},{"id":"ref-for-elementdef-ruby\u2461\u2462"},{"id":"ref-for-elementdef-ruby\u2461\u2463"},{"id":"ref-for-elementdef-ruby\u2461\u2464"},{"id":"ref-for-elementdef-ruby\u2461\u2465"},{"id":"ref-for-elementdef-ruby\u2461\u2466"}],"title":"\nAppendix A:\nEditorial Tweaks to HTML"}],"url":"#elementdef-ruby"},
"ruby": {"dfnID":"ruby","dfnText":"Ruby","external":false,"refSections":[],"url":"#ruby"},
"ruby-annotation-range": {"dfnID":"ruby-annotation-range","dfnText":"ruby annotation range","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-annotation-range"},{"id":"ref-for-ruby-annotation-range\u2460"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-ruby-annotation-range\u2461"},{"id":"ref-for-ruby-annotation-range\u2462"},{"id":"ref-for-ruby-annotation-range\u2463"},{"id":"ref-for-ruby-annotation-range\u2464"},{"id":"ref-for-ruby-annotation-range\u2465"},{"id":"ref-for-ruby-annotation-range\u2466"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-ruby-annotation-range\u2467"},{"id":"ref-for-ruby-annotation-range\u2468"}],"title":"2.4. \nThe rtc element"}],"url":"#ruby-annotation-range"},
"ruby-annotation-units": {"dfnID":"ruby-annotation-units","dfnText":"ruby annotation units","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-annotation-units"},{"id":"ref-for-ruby-annotation-units\u2460"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-ruby-annotation-units\u2461"},{"id":"ref-for-ruby-annotation-units\u2462"},{"id":"ref-for-ruby-annotation-units\u2463"},{"id":"ref-for-ruby-annotation-units\u2464"},{"id":"ref-for-ruby-annotation-units\u2465"},{"id":"ref-for-ruby-annotation-units\u2466"},{"id":"ref-for-ruby-annotation-units\u2467"},{"id":"ref-for-ruby-annotation-units\u2468"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-ruby-annotation-units\u2460\u24ea"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-ruby-annotation-units\u2460\u2460"}],"title":"2.4. \nThe rtc element"},{"refs":[{"id":"ref-for-ruby-annotation-units\u2460\u2461"},{"id":"ref-for-ruby-annotation-units\u2460\u2462"}],"title":"2.5. \nThe rp element"}],"url":"#ruby-annotation-units"},
"ruby-base-range": {"dfnID":"ruby-base-range","dfnText":"ruby base range","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-base-range"},{"id":"ref-for-ruby-base-range\u2460"},{"id":"ref-for-ruby-base-range\u2461"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-ruby-base-range\u2462"}],"title":"2.4. \nThe rtc element"}],"url":"#ruby-base-range"},
"ruby-base-units": {"dfnID":"ruby-base-units","dfnText":"ruby base units","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-base-units"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-ruby-base-units\u2460"},{"id":"ref-for-ruby-base-units\u2461"},{"id":"ref-for-ruby-base-units\u2462"},{"id":"ref-for-ruby-base-units\u2463"},{"id":"ref-for-ruby-base-units\u2464"},{"id":"ref-for-ruby-base-units\u2465"}],"title":"2.1.1. \nRuby Segmentation and Pairing"},{"refs":[{"id":"ref-for-ruby-base-units\u2466"},{"id":"ref-for-ruby-base-units\u2467"}],"title":"2.1.2. \nMarkup Patterns for Multi-Character Ruby"},{"refs":[{"id":"ref-for-ruby-base-units\u2468"}],"title":"2.2. \nThe rb element"},{"refs":[{"id":"ref-for-ruby-base-units\u2460\u24ea"}],"title":"2.3. \nThe rt element"},{"refs":[{"id":"ref-for-ruby-base-units\u2460\u2460"}],"title":"2.4. \nThe rtc element"}],"url":"#ruby-base-units"},
"ruby-segment": {"dfnID":"ruby-segment","dfnText":"ruby segment","external":false,"refSections":[{"refs":[{"id":"ref-for-ruby-segment"}],"title":"2.1. \nThe ruby element"},{"refs":[{"id":"ref-for-ruby-segment\u2460"},{"id":"ref-for-ruby-segment\u2461"}],"title":"2.1.1. \nRuby Segmentation and Pairing"}],"url":"#ruby-segment"},
"tabular-markup": {"dfnID":"tabular-markup","dfnText":"tabular markup","external":false,"refSections":[{"refs":[{"id":"ref-for-tabular-markup"},{"id":"ref-for-tabular-markup\u2460"},{"id":"ref-for-tabular-markup\u2461"}],"title":"\nAppendix B:\nComparison With The HTML Standard"}],"url":"#tabular-markup"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#elementdef-rb": {"displayText":"rb","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"rb","type":"element","url":"#elementdef-rb"},
"#elementdef-rp": {"displayText":"rp","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"rp","type":"element","url":"#elementdef-rp"},
"#elementdef-rt": {"displayText":"rt","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"rt","type":"element","url":"#elementdef-rt"},
"#elementdef-rtc": {"displayText":"rtc","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"rtc","type":"element","url":"#elementdef-rtc"},
"#elementdef-ruby": {"displayText":"ruby","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"ruby","type":"element","url":"#elementdef-ruby"},
"#ruby-annotation-range": {"displayText":"annotation range","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"annotation range","type":"dfn","url":"#ruby-annotation-range"},
"#ruby-annotation-units": {"displayText":"annotation unit","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"annotation unit","type":"dfn","url":"#ruby-annotation-units"},
"#ruby-base-range": {"displayText":"ruby base range","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"ruby base range","type":"dfn","url":"#ruby-base-range"},
"#ruby-base-units": {"displayText":"ruby base units","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"ruby base units","type":"dfn","url":"#ruby-base-units"},
"#ruby-segment": {"displayText":"ruby segment","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"ruby segment","type":"dfn","url":"#ruby-segment"},
"#tabular-markup": {"displayText":"tabular markup","export":true,"for_":[],"level":"","normative":true,"shortname":"html-ruby-extensions","spec":"html-ruby-extensions","status":"local","text":"tabular markup","type":"dfn","url":"#tabular-markup"},
"https://drafts.csswg.org/css-display-4/#propdef-display": {"displayText":"display","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"display","type":"property","url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"https://drafts.csswg.org/css-ruby-1/#propdef-ruby-position": {"displayText":"ruby-position","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"current","text":"ruby-position","type":"property","url":"https://drafts.csswg.org/css-ruby-1/#propdef-ruby-position"},
"https://drafts.csswg.org/css-ruby-1/#valdef-display-ruby-base": {"displayText":"ruby-base","export":true,"for_":["display"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"current","text":"ruby-base","type":"value","url":"https://drafts.csswg.org/css-ruby-1/#valdef-display-ruby-base"},
"https://drafts.csswg.org/css-ruby-1/#valdef-ruby-position-alternate": {"displayText":"alternate","export":true,"for_":["ruby-position"],"level":"1","normative":true,"shortname":"css-ruby","spec":"css-ruby-1","status":"current","text":"alternate","type":"value","url":"https://drafts.csswg.org/css-ruby-1/#valdef-ruby-position-alternate"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations": {"displayText":"accessibility considerations","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"accessibility considerations","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-accessibility-considerations"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes": {"displayText":"content attributes","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"content attributes","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories": {"displayText":"categories","export":true,"for_":["/"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"categories","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-categories"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model": {"displayText":"content model","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"content model","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-content-model"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts": {"displayText":"contexts in which this element can be used","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"contexts in which this element can be used","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-contexts"},
"https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom": {"displayText":"DOM interface","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"dom interface","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#concept-element-dom"},
"https://html.spec.whatwg.org/multipage/dom.html#flow-content-2": {"displayText":"flow content","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"flow content","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#flow-content-2"},
"https://html.spec.whatwg.org/multipage/dom.html#global-attributes": {"displayText":"global attributes","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global attributes","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#global-attributes"},
"https://html.spec.whatwg.org/multipage/dom.html#htmlelement": {"displayText":"HTMLElement","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/dom.html#htmlelement"},
"https://html.spec.whatwg.org/multipage/dom.html#inter-element-whitespace": {"displayText":"inter-element whitespace","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"inter-element whitespace","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#inter-element-whitespace"},
"https://html.spec.whatwg.org/multipage/dom.html#palpable-content-2": {"displayText":"palpable content","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"palpable content","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#palpable-content-2"},
"https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2": {"displayText":"phrasing content","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"phrasing content","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#phrasing-content-2"},
"https://html.spec.whatwg.org/multipage/dom.html#represents": {"displayText":"represent","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"represent","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#represents"},
"https://html.spec.whatwg.org/multipage/dom.html#text-content": {"displayText":"text","export":true,"for_":["/"],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"text","type":"dfn","url":"https://html.spec.whatwg.org/multipage/dom.html#text-content"},
"https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag": {"displayText":"end tags","export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"end tags","type":"dfn","url":"https://html.spec.whatwg.org/multipage/syntax.html#syntax-end-tag"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>